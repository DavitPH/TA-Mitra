<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Komentar</title>
    <!-- Tailwind CSS CDN untuk styling yang responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts - Poppins untuk tipografi yang konsisten -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* Mengatur font Poppins sebagai font utama untuk seluruh body */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            /* Warna latar belakang umum */
        }

        /* Kustomisasi scrollbar untuk tampilan yang lebih baik */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f0f2f5;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Styling untuk sidebar yang tetap */
        .fixed-sidebar {
            position: fixed;
            /* Membuat sidebar tetap */
            left: 0;
            /* Sejajar dengan tepi kiri */
            top: 0;
            /* Sejajar dengan tepi atas */
            bottom: 0;
            /* Membentang sepanjang tinggi penuh */
            z-index: 50;
            /* Memastikan di atas konten lain */
        }

        /* Menyesuaikan margin konten utama agar tidak tumpang tindih dengan sidebar yang tetap */
        .main-content-margin {
            margin-left: 16rem;
            /* Sesuaikan nilai ini agar sesuai dengan lebar sidebar (w-64 = 16rem) */
        }

        /* Penyesuaian responsif untuk layar yang lebih kecil jika diperlukan (misalnya, sidebar menghilang atau menjadi dapat digulir) */
        @media (max-width: 768px) {
            .fixed-sidebar {
                position: relative;
                /* Membuat sidebar relatif di layar kecil */
                width: 100%;
                height: auto;
                border-radius: 0;
            }

            .main-content-margin {
                margin-left: 0;
                /* Hapus margin di layar kecil */
            }

            .flex-col.md\:flex-row {
                /* Mengembalikan arah flex untuk bilah pencarian/aksi atas di layar kecil */
                flex-direction: column;
            }

            .mr-0.md\:mr-4 {
                margin-right: 0;
            }

            .mb-4.md\:mb-0 {
                margin-bottom: 1rem;
            }
        }

        /* Styling untuk modal konfirmasi */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        /* Styling untuk notifikasi sukses (berubah ke kanan atas sesuai referensi) */
        .notification {
            position: fixed;
            top: 1rem;
            /* Posisi dari atas */
            right: 1rem;
            /* Posisi dari kanan */
            padding: 0.75rem 1.5rem;
            /* Padding */
            border-radius: 0.5rem;
            /* Sudut membulat */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* Bayangan */
            z-index: 1000;
            display: none;
            /* Hidden by default */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-weight: 500;
            background-color: #10B981;
            /* Default green background */
        }

        .notification.show {
            opacity: 1;
        }
    </style>
</head>

<body class="flex min-h-screen">

    <!-- Main Navigation Sidebar -->
    <aside class="w-64 bg-green-700 text-white flex flex-col p-4 rounded-r-lg shadow-lg fixed-sidebar">
        <div class="flex items-center justify-center mb-10 mt-4">
            <div class="w-20 h-20 flex items-center justify-center p-2">
                <!-- Snail logo from your provided image -->
                <img src="logo.png" alt="Snail Logo" class="w-full h-full object-contain">
            </div>
        </div>
        <nav class="flex-grow">
            <ul>
                <li class="mb-4">
                    <a href="daftarSpesies.html"
                        class="flex items-center p-3 rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-bug text-xl mr-3"></i>
                        <span class="font-medium text-lg">Invertebrata</span>
                    </a>
                </li>
                <li class="mb-4">
                    <a href="daftarKomentar.html" class="flex items-center p-3 rounded-lg bg-green-800 shadow-md">
                        <i class="fas fa-comment-alt text-xl mr-3"></i>
                        <span class="font-medium text-lg">Komentar</span>
                    </a>
                </li>
                <li class="mb-4">
                    <a href="daftarAkun.html"
                        class="flex items-center p-3 rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-comment-alt text-xl mr-3"></i>
                        <span class="font-medium text-lg">Akun Pengguna</span>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- Bagian bawah sidebar, bisa untuk logout atau info lainnya -->
        <div class="mt-auto pt-4 border-t border-green-600">
            <a href="index.html" class="flex items-center p-3 rounded-lg hover:bg-green-600 transition-colors">
                <i class="fas fa-sign-out-alt text-xl mr-3"></i>
                <span class="font-medium text-lg">Logout</span>
            </a>
        </div>
    </aside>

    <!-- Konten Utama Aplikasi -->
    <main class="flex-1 p-8 main-content-margin">
        <!-- Notifikasi Sukses dipindahkan ke sini untuk berada di atas konten utama secara visual, tapi posisi tetap fixed -->
        <div id="successNotification" class="notification text-white font-semibold">
            <!-- Pesan akan diisi oleh JavaScript -->
        </div>

        <!-- Navigasi Breadcrumb -->
        <nav class="mb-6 text-gray-600 text-lg">
            <a href="daftarKomentar.html" class="hover:underline">Daftar Komentar</a>
            <span class="mx-2 font-bold text-gray-800">&gt;</span>
            <span class="font-semibold text-gray-800">Detail Komentar</span>
        </nav>

        <header class="mb-8">
            <!-- Header komentar, jumlah dihilangkan -->
            <h1 class="text-3xl font-bold text-gray-800" id="totalCommentsHeader">Komentar</h1>
        </header>

        <!-- Area Tulis Komentar Baru -->
        <section class="bg-white p-6 rounded-xl shadow-md mb-8">
            <div class="border border-gray-300 rounded-lg overflow-hidden">
                <div class="px-4 py-3 bg-gray-50 border-b border-gray-300">
                    <textarea id="newCommentTextarea" class="w-full bg-gray-50 focus:outline-none resize-none" rows="4"
                        placeholder="Tuliskan komentar"></textarea>
                </div>
                <div class="px-4 py-2 flex items-center justify-end">
                    <button id="sendCommentButton"
                        class="px-6 py-2 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 transition-colors">
                        Kirim
                    </button>
                </div>
            </div>
        </section>

        <!-- Daftar Komentar -->
        <section id="commentsList" class="space-y-6">
            <!-- Komentar Contoh 1 -->
            <div class="bg-white p-6 rounded-xl shadow-md" id="comment-1">
                <div class="flex items-start space-x-4">
                    <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=DA" alt="Avatar user@example.com"
                        class="w-10 h-10 rounded-full object-cover">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <div class="flex items-center space-x-2">
                                <span
                                    class="font-semibold text-gray-900 comment-author-email">davitputra@example.com</span>
                                <span class="text-gray-500 text-sm">1 Juli 2025</span>
                            </div>
                            <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                data-comment-id="1"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="comment-content text-gray-800 mb-2">Spesies yang menarik! Saya pernah menemukannya di
                            danau dekat rumah.</p>
                        <button class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>

                        <!-- Kontainer form balasan yang akan ditampilkan/disembunyikan (DITAMBAHKAN/DIKONFIRMASI DI SINI) -->
                        <div class="reply-form-container mt-2 hidden">
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                rows="2" placeholder="Tulis balasan..."></textarea>
                            <div class="flex justify-end mt-2 space-x-2">
                                <button
                                    class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                <button
                                    class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                    Balasan</button>
                            </div>
                        </div>

                        <!-- Kontainer untuk Balasan -->
                        <div class="replies-container">
                            <!-- Contoh Balasan 1 (ID diubah agar konsisten) -->
                            <div class="mt-4 pl-12 border-l-2 border-gray-200 py-2 flex items-start space-x-4"
                                id="comment-static-reply-1-1">
                                <img src="https://placehold.co/32x32/E2E8F0/4A5568?text=AD" alt="Avatar admin@mitra.com"
                                    class="w-8 h-8 rounded-full object-cover">
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center space-x-2">
                                            <span
                                                class="font-semibold text-gray-900 comment-author-email">admin@mitra.com</span>
                                            <span class="text-gray-500 text-sm">1 Juli 2025</span>
                                        </div>
                                        <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                            data-comment-id="comment-static-reply-1-1"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                    <p class="comment-content text-gray-800 mb-2">Terima kasih atas informasinya,
                                        Davit! Apakah Anda punya foto-foto dari penemuan tersebut?</p>
                                    <button
                                        class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>
                                    <div class="reply-form-container mt-2 hidden">
                                        <textarea
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                            rows="2" placeholder="Tulis balasan..."></textarea>
                                        <div class="flex justify-end mt-2 space-x-2">
                                            <button
                                                class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                            <button
                                                class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                                Balasan</button>
                                        </div>
                                    </div>
                                    <div class="replies-container"></div>
                                </div>
                            </div>

                            <!-- Contoh Balasan 2 (ID diubah agar konsisten) -->
                            <div class="mt-4 pl-12 border-l-2 border-gray-200 py-2 flex items-start space-x-4"
                                id="comment-static-reply-1-2">
                                <img src="https://placehold.co/32x32/E2E8F0/4A5568?text=AN"
                                    alt="Avatar anonymous@user.com" class="w-8 h-8 rounded-full object-cover">
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center space-x-2">
                                            <span
                                                class="font-semibold text-gray-900 comment-author-email">anonymous@user.com</span>
                                            <span class="text-gray-500 text-sm">2 Juli 2025</span>
                                        </div>
                                        <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                            data-comment-id="comment-static-reply-1-2"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                    <p class="comment-content text-gray-800 mb-2">Saya juga menemukan yang serupa di
                                        daerah X. Sangat menarik!</p>
                                    <button
                                        class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>
                                    <div class="reply-form-container mt-2 hidden">
                                        <textarea
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                            rows="2" placeholder="Tulis balasan..."></textarea>
                                        <div class="flex justify-end mt-2 space-x-2">
                                            <button
                                                class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                            <button
                                                class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                                Balasan</button>
                                        </div>
                                    </div>
                                    <div class="replies-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Komentar Contoh 2 -->
            <div class="bg-white p-6 rounded-xl shadow-md" id="comment-2">
                <div class="flex items-start space-x-4">
                    <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=AN" alt="Avatar anna@example.com"
                        class="w-10 h-10 rounded-full object-cover">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold text-gray-900 comment-author-email">anna@example.com</span>
                                <span class="text-gray-500 text-sm">30 Juni 2025</span>
                            </div>
                            <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                data-comment-id="2"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="comment-content text-gray-800 mb-2">Apakah spesies ini termasuk invasif? Saya khawatir
                            dengan dampaknya terhadap ekosistem lokal.</p>
                        <button class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>

                        <!-- Kontainer form balasan yang akan ditampilkan/disembunyikan (DITAMBAHKAN/DIKONFIRMASI DI SINI) -->
                        <div class="reply-form-container mt-2 hidden">
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                rows="2" placeholder="Tulis balasan..."></textarea>
                            <div class="flex justify-end mt-2 space-x-2">
                                <button
                                    class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                <button
                                    class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                    Balasan</button>
                            </div>
                        </div>

                        <!-- Kontainer untuk Balasan -->
                        <div class="replies-container">
                            <!-- Contoh Balasan untuk Komentar 2 (ID diubah agar konsisten) -->
                            <div class="mt-4 pl-12 border-l-2 border-gray-200 py-2 flex items-start space-x-4"
                                id="comment-static-reply-2-1">
                                <img src="https://placehold.co/32x32/E2E8F0/4A5568?text=AD" alt="Avatar admin@mitra.com"
                                    class="w-8 h-8 rounded-full object-cover">
                                <div class="flex-1">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center space-x-2">
                                            <span
                                                class="font-semibold text-gray-900 comment-author-email">admin@mitra.com</span>
                                            <span class="text-gray-500 text-sm">30 Juni 2025</span>
                                        </div>
                                        <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                            data-comment-id="comment-static-reply-2-1"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                    <p class="comment-content text-gray-800 mb-2">Pertanyaan bagus, Anna! Data
                                        menunjukkan spesies ini belum dikategorikan invasif di banyak wilayah, namun
                                        perlu pemantauan lebih lanjut.</p>
                                    <button
                                        class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>
                                    <div class="reply-form-container mt-2 hidden">
                                        <textarea
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                            rows="2" placeholder="Tulis balasan..."></textarea>
                                        <div class="flex justify-end mt-2 space-x-2">
                                            <button
                                                class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                            <button
                                                class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                                Balasan</button>
                                        </div>
                                    </div>
                                    <div class="replies-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Komentar Contoh 3 (joko@example.com) -->
            <div class="bg-white p-6 rounded-xl shadow-md" id="comment-3">
                <div class="flex items-start space-x-4">
                    <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=JO" alt="Avatar joko@example.com"
                        class="w-10 h-10 rounded-full object-cover">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold text-gray-900 comment-author-email">joko@example.com</span>
                                <span class="text-gray-500 text-sm">29 Juni 2025</span>
                            </div>
                            <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn"
                                data-comment-id="3"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="comment-content text-gray-800 mb-2">Populasi mereka tampaknya meningkat di daerah
                            saya. Apakah ini normal?</p>
                        <button class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>

                        <!-- Kontainer form balasan yang akan ditampilkan/disembunyikan (DITAMBAHKAN/DIKONFIRMASI DI SINI) -->
                        <div class="reply-form-container mt-2 hidden">
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none"
                                rows="2" placeholder="Tulis balasan..."></textarea>
                            <div class="flex justify-end mt-2 space-x-2">
                                <button
                                    class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                <button
                                    class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-orange-600 transition-colors send-reply-btn">Kirim
                                    Balasan</button>
                            </div>
                        </div>

                        <!-- Kontainer untuk Balasan (kosong jika tidak ada balasan) -->
                        <div class="replies-container"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Konfirmasi Hapus -->
    <div id="deleteConfirmationModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Hapus Komentar?</h2>
            <p id="deleteMessage" class="text-gray-700 mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="cancelDeleteBtn"
                    class="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-400 transition-colors">Batal</button>
                <button id="confirmDeleteBtn"
                    class="px-6 py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors">Ya</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Referensi elemen DOM
            const totalCommentsHeader = document.getElementById('totalCommentsHeader');
            const newCommentTextarea = document.getElementById('newCommentTextarea');
            const sendCommentButton = document.getElementById('sendCommentButton');
            const commentsList = document.getElementById('commentsList');

            // Elemen modal
            const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
            const deleteMessage = document.getElementById('deleteMessage');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

            // Elemen notifikasi
            const successNotification = document.getElementById('successNotification');

            let commentToDelete = null; // Menyimpan referensi elemen komentar yang akan dihapus
            let authorEmailOfCommentToDelete = ''; // Menyimpan email penulis komentar yang akan dihapus

            // Variabel untuk menghitung total komentar
            let totalComments;

            // Fungsi untuk menghitung semua komentar dan balasan
            function countAllCommentsAndReplies() {
                // Seleksi semua elemen div yang memiliki kelas 'flex items-start space-x-4'
                // Ini akan mencakup baik komentar tingkat atas maupun balasan
                return commentsList.querySelectorAll('div.flex.items-start.space-x-4').length;
            }

            // Fungsi untuk memperbarui tampilan jumlah komentar
            function updateTotalCommentsDisplay() {
                totalCommentsHeader.textContent = `Komentar (${totalComments})`;
                console.log(`[DEBUG] Total Komentar diperbarui: ${totalComments}`); // Log untuk debug
            }

            // Fungsi untuk menampilkan notifikasi sukses
            function showSuccessNotification(message) {
                successNotification.textContent = message;
                successNotification.style.display = 'block';
                // Paksa reflow untuk transisi CSS
                successNotification.offsetWidth;
                successNotification.classList.add('show');

                // Tambahkan kelas background sesuai jenis notifikasi. Untuk notifikasi sukses defaultnya green.
                successNotification.classList.add('bg-green-500');


                setTimeout(() => {
                    successNotification.classList.remove('show');
                    // Tunggu transisi selesai sebelum menyembunyikan display
                    setTimeout(() => {
                        successNotification.style.display = 'none';
                        // Hapus kelas background setelah tersembunyi
                        successNotification.classList.remove('bg-green-500');
                    }, 500); // Sesuaikan dengan durasi transisi CSS
                }, 3000); // Notifikasi akan hilang setelah 3 detik
            }

            // Fungsi untuk membuat elemen komentar atau balasan baru
            function createCommentElement(commentText, authorEmail, date, isReply = false) {
                const atIndex = authorEmail.indexOf('@');
                let initials = '';
                if (atIndex > 0) {
                    const namePart = authorEmail.substring(0, atIndex);
                    initials = namePart.split('.').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    if (initials.length === 0 && namePart.length > 0) {
                        initials = namePart.substring(0, 2).toUpperCase();
                    }
                }
                if (initials.length === 0) {
                    initials = authorEmail.substring(0, 2).toUpperCase();
                }

                const avatarSizeClass = isReply ? 'w-8 h-8' : 'w-10 h-10';

                // Main wrapper for comment/reply
                const commentElement = document.createElement('div');
                // Berikan ID unik yang konsisten untuk semua komentar/balasan
                commentElement.id = `comment-${Date.now() + Math.random().toString(36).substring(2, 9)}`;

                // Set classes based on whether it's a reply or a top-level comment
                let classes = ['flex', 'items-start', 'space-x-4']; // Ini adalah kelas utama untuk konten komentar/balasan
                if (isReply) {
                    // Untuk balasan, tidak pakai bg-white, shadow, atau rounded-xl di sini
                    classes.push('mt-4', 'pl-12', 'border-l-2', 'border-gray-200', 'py-2');
                } else {
                    // Untuk komentar tingkat atas, TAMBAHKAN kelas kartu ke array kelas
                    classes.push('bg-white', 'p-6', 'rounded-xl', 'shadow-md');
                }
                commentElement.className = classes.join(' '); // Terapkan semua kelas dari array

                commentElement.innerHTML = `
                    <img src="https://placehold.co/${isReply ? '32x32' : '40x40'}/E2E8F0/4A5568?text=${initials}" alt="Avatar ${authorEmail}" class="${avatarSizeClass} rounded-full object-cover">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <div class="flex items-center space-x-2"> 
                                <span class="font-semibold text-gray-900 comment-author-email">${authorEmail}</span>
                                <span class="text-gray-500 text-sm">${date}</span>
                            </div>
                            <button class="text-gray-400 hover:text-red-500 transition-colors delete-btn" data-comment-id="${commentElement.id}"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="comment-content text-gray-800 mb-2"></p>
                        <button class="text-blue-600 hover:underline text-sm font-medium reply-btn">Balas</button>
                        <div class="reply-form-container mt-2 hidden">
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none" rows="2" placeholder="Tulis balasan..."></textarea>
                            <div class="flex justify-end mt-2 space-x-2">
                                <button class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg text-sm hover:bg-gray-400 transition-colors cancel-reply-btn">Batal</button>
                                <button class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg text-sm hover:bg-blue-600 transition-colors send-reply-btn">Kirim Balasan</button>
                            </div>
                        </div>
                        <div class="replies-container"></div>
                    </div>
                `;

                commentElement.querySelector('.comment-content').innerHTML = commentText;

                // Pasang event listener untuk elemen yang baru dibuat ini
                attachEventListenersToComment(commentElement);

                return commentElement;
            }

            // Fungsi untuk memasang event listener ke elemen komentar/balasan
            function attachEventListenersToComment(commentElement) {
                // Fungsionalitas Hapus Komentar/Balasan
                const deleteButton = commentElement.querySelector('.delete-btn');
                if (deleteButton) {
                    deleteButton.addEventListener('click', function () {
                        // Temukan elemen wrapper terluar yang memiliki ID "comment-"
                        const outermostWrapper = commentElement.closest('[id^="comment-"]');
                        if (outermostWrapper) {
                            commentToDelete = outermostWrapper; // Simpan referensi ke elemen yang akan dihapus
                            const authorEmailElement = commentToDelete.querySelector('.comment-author-email');
                            authorEmailOfCommentToDelete = authorEmailElement ? authorEmailElement.textContent : 'pengguna ini'; // Ambil email atau fallback

                            deleteMessage.textContent = `Hapus pesan pengguna ${authorEmailOfCommentToDelete}?`;
                            deleteConfirmationModal.style.display = 'flex'; // Tampilkan modal
                        }
                    });
                }

                // Fungsionalitas Balas Komentar
                const replyButton = commentElement.querySelector('.reply-btn');
                const replyFormContainer = commentElement.querySelector('.reply-form-container');
                const repliesContainer = commentElement.querySelector('.replies-container');

                if (replyButton && replyFormContainer && repliesContainer) {
                    replyButton.addEventListener('click', function () {
                        replyFormContainer.classList.toggle('hidden'); // Tampilkan/sembunyikan form balasan
                        if (!replyFormContainer.classList.contains('hidden')) {
                            replyFormContainer.querySelector('textarea').focus(); // Fokuskan textarea saat ditampilkan
                        }
                    });

                    const sendReplyButton = replyFormContainer.querySelector('.send-reply-btn');
                    const cancelReplyButton = replyFormContainer.querySelector('.cancel-reply-btn');

                    if (sendReplyButton) {
                        sendReplyButton.addEventListener('click', function () {
                            const replyTextarea = replyFormContainer.querySelector('textarea');
                            const replyContent = replyTextarea.value.trim();

                            if (replyContent) {
                                const replyDate = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                                // isReply disetel true karena ini balasan
                                const newReplyElement = createCommentElement(replyContent, 'admin@mitra.com', replyDate, true);

                                // Gunakan appendChild untuk menambahkan balasan baru di akhir daftar balasan
                                repliesContainer.appendChild(newReplyElement);

                                totalComments++; // Tambahkan totalComments
                                updateTotalCommentsDisplay(); // Perbarui tampilan

                                replyTextarea.value = ''; // Kosongkan textarea balasan
                                replyFormContainer.classList.add('hidden'); // Sembunyikan form balasan
                            }
                        });
                    }

                    // Fungsionalitas Tombol Batal untuk Balasan
                    if (cancelReplyButton) {
                        cancelReplyButton.addEventListener('click', function () {
                            replyFormContainer.querySelector('textarea').value = ''; // Kosongkan textarea
                            replyFormContainer.classList.add('hidden'); // Sembunyikan form
                        });
                    }
                }
            }

            // Fungsi untuk menginisialisasi semua komentar dan balasannya yang sudah ada di DOM
            function initializeAllComments(containerElement) {
                // Seleksi semua elemen yang memiliki ID yang diawali dengan "comment-"
                const commentAndReplyElements = containerElement.querySelectorAll('[id^="comment-"]');

                commentAndReplyElements.forEach(commentElement => {
                    // Perluas seleksi untuk menemukan elemen div.flex.items-start.space-x-4 di dalamnya
                    let innerContentDiv = commentElement.querySelector('.flex.items-start.space-x-4');
                    // Jika elemen ini sendiri adalah div.flex.items-start.space-x-4 (kasus reply statis yang tidak punya wrapper bg-white)
                    if (!innerContentDiv) {
                        innerContentDiv = commentElement;
                    }

                    if (innerContentDiv) {
                        attachEventListenersToComment(innerContentDiv);
                    }
                });
            }

            // --- Fungsionalitas Kirim Komentar Baru (Tingkat Atas) ---
            sendCommentButton.addEventListener('click', function () {
                const commentContent = newCommentTextarea.value.trim();
                if (commentContent) {
                    const commentDate = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                    // Buat elemen komentar baru (bukan balasan)
                    const newCommentElement = createCommentElement(commentContent, 'admin@mitra.com', commentDate, false);
                    // Gunakan prepend untuk menambahkan komentar baru di awal daftar
                    commentsList.prepend(newCommentElement);
                    newCommentTextarea.value = ''; // Kosongkan textarea komentar baru

                    totalComments++; // Tambahkan totalComments
                    updateTotalCommentsDisplay(); // Perbarui tampilan
                }
            });

            // Event listener untuk tombol konfirmasi hapus modal
            confirmDeleteBtn.addEventListener('click', function () {
                if (commentToDelete) {
                    commentToDelete.remove(); // Hapus elemen komentar
                    totalComments--; // Kurangi totalComments
                    updateTotalCommentsDisplay(); // Perbarui tampilan

                    // Tampilkan notifikasi sukses
                    showSuccessNotification(`Komentar ${authorEmailOfCommentToDelete} berhasil dihapus.`);
                }
                deleteConfirmationModal.style.display = 'none'; // Sembunyikan modal
                commentToDelete = null; // Reset referensi
                authorEmailOfCommentToDelete = ''; // Reset email penulis
            });

            // Event listener untuk tombol batal hapus modal
            cancelDeleteBtn.addEventListener('click', function () {
                deleteConfirmationModal.style.display = 'none'; // Sembunyikan modal
                commentToDelete = null; // Reset referensi
                authorEmailOfCommentToDelete = ''; // Reset email penulis
            });

            // Inisialisasi hitungan komentar saat halaman dimuat
            totalComments = countAllCommentsAndReplies(); // Inisialisasi totalComments
            updateTotalCommentsDisplay(); // Perbarui tampilan header dengan hitungan awal
            console.log(`[DEBUG] Initial comment count on load: ${totalComments}`); // Log untuk debug

            // Inisialisasi semua komentar dan balasan yang sudah ada di DOM saat halaman dimuat
            initializeAllComments(commentsList);
        });
    </script>
</body>

</html>